import pandas as pd
from optimalcodon.projects.rnastability.optimization import protein_optimization

# params
mdl_path = '../19-04-30-PredictiveModelDecayAllSpecies/19-05-01-TrainModels/results_data/final_model_gbm.joblib'
n_iterations = 150
# optimize human gene that is midl stable in RPE

gene_name = "eGFP"
seq = "ATGGTGAGCAAGGGCGAGGAGCTGTTCACCGGGGTGGTGCCCATCCTGGTCGAGCTGGACGGCGACGTAAACGGCCACAAGTTCAGCGTGTCCGGCGAGGGCGAGGGCGATGCCACCTACGGCAAGCTGACCCTGAAGTTCATCTGCACCACCGGCAAGCTGCCCGTGCCCTGGCCCACCCTCGTGACCACCCTGACCTACGGCGTGCAGTGCTTCAGCCGCTACCCCGACCACATGAAGCAGCACGACTTCTTCAAGTCCGCCATGCCCGAAGGCTACGTCCAGGAGCGCACCATCTTCTTCAAGGACGACGGCAACTACAAGACCCGCGCCGAGGTGAAGTTCGAGGGCGACACCCTGGTGAACCGCATCGAGCTGAAGGGCATCGACTTCAAGGAGGACGGCAACATCCTGGGGCACAAGCTGGAGTACAACTACAACAGCCACAACGTCTATATCATGGCCGACAAGCAGAAGAACGGCATCAAGGTGAACTTCAAGATCCGCCACAACATCGAGGACGGCAGCGTGCAGCTCGCCGACCACTACCAGCAGAACACCCCCATCGGCGACGGCCCCGTGCTGCTGCCCGACAACCACTACCTGAGCACCCAGTCCGCCCTGAGCAAAGACCCCAACGAGAAGCGCGATCACATGGTCCTGCTGGAGTTCGTGACCGCCGCCGGGATCACTCTCGGCATGGACGAGCTGTACAAG"
# optimize gene in rpe
mdl_params = {'specie': 'human', 'cell_type': 'RPE', 'datatype': 'endogenous'}
res_rpe = protein_optimization(seq, mdl_path, mdl_params, crossover_args={}, niterations=n_iterations)
res_rpe['gene'] = 'neutral human gene ' + gene_name

# fish gene
gene_name = "APEX"
seq = "GGAAAGTCTTACCCAACTGTGAGTGCTGATTACCAGGACGCCGTTGAGAAGGCGAAGAAGAAGCTCAGAGGCTTCATCGCTGAGAAGAGATGCGCTCCTCTAATGCTCCGTTTGGCATTCCACTCTGCTGGAACCTTTGACAAGGGCACGAAGACCGGTGGACCCTTCGGAACCATCAAGCACCCTGCCGAACTGGCTCACAGCGCTAACAACGGTCTTGACATCGCTGTTAGGCTTTTGGAGCCACTCAAGGCGGAGTTCCCTATTTTGAGCTACGCCGATTTCTACCAGTTGGCTGGCGTTGTTGCCGTTGAGGTCACGGGTGGACCTAAGGTTCCATTCCACCCTGGAAGAGAGGACAAGCCTGAGCCACCACCAGAGGGTCGCTTGCCTGATCCCACTAAGGGTTCTGACCATTTGAGAGATGTGTTTGGCAAAGCTATGGGGCTTACTGACCAAGATATCGTTGCTCTATCTGGGGGTCACACTATTGGAGCTGCACACAAGGAGCGTTCTGGATTTGAGGGTCCCTGGACCTCTAATCCTCTTATTTTCGACAACTCATACTTCACGGAGTTGTTGAGTGGTGAGAAGGAAGGTCTCCTTCAGCTACCTTCTGACAAGGCTCTTTTGTCTGACCCTGTATTCCGCCCTCTCGTTGATAAATATGCAGCGGACGAAGATGCCTTCTTTGCTGATTACGCTGAGGCTCACCAAAAGCTTTCCGAGCTTGGGTTTGCTGATGCC"

mdl_params = {'specie': 'fish', 'cell_type': 'embryo mzt', 'datatype': 'aamanitin polya'}
res_fish = protein_optimization(seq, mdl_path, mdl_params, crossover_args={}, niterations=n_iterations)
res_fish['gene'] = gene_name

# non optimal mouse gene
gene_name = "ENSMUSG00000001036"
seq = "ATGACAACTTCATCTATCAGACGGCAGATGAAAAACATTGTGAACAATTACTCAGAGGCTGAAATCAAAGTCCGGGAGGCCACCTCCAATGACCCGTGGGGCCCATCCAGCTCTCTGATGACTGAGATTGCTGACCTGACCTACAATGTGGTAGCGTTCTCGGAGATCATGAGCATGGTTTGGAAGCGACTTAATGACCATGGCAAGAACTGGCGGCATGTATACAAGGCACTGACACTGCTGGACTACCTTATCAAGACAGGTTCTGAGCGGGTGGCCCAGCAGTGCCGTGAGAACATCTTTGCCATACAGACTCTGAAGGACTTTCAGTACATTGACCGTGATGGCAAAGACCAGGGTATTAACGTTCGAGAGAAATCAAAGCAACTGGTTGCGCTCCTCAAGGATGAGGAGCGGCTGAAGGTTGAGAGAGTTCAGGCTCTCAAAACCAAAGAGCGCATGGCTCAGGTGGCCACTGGCGTGGGCAGCAACCAAATCACCTTTGGCCGTGGCTCCAGCCAGCCCAACCTTTCTACCAGCTACTCAGAGCAGGAGTATGGCAAGGCTGGGGGCTCGCCGGCATCCTACCACGGCTCGCCAGAGGCCTCGCTGTGCCCCCAGCACCGCACAGGGGCCATGCTGGGTCAGAGTGAGGAGCTGCAGCCACTGAGCCAGCGCCACCCCTGCCTGCCGCACCTGGGCCTAGCCTCCCACCCTAATGGCGACTGGGCCCAGCCCTGCCTCACTTGTGACCGCGCAGCCCGAGCTACTTCCCCACGAGTATCCTCTGAGTTAGAGCAGGCCCGGCCACAGACAAGCGGAGAAGAGGAGCTGCAGCTACAACTGGCACTTGCCATGAGCAGAGAGGTTGCTGAGCAGGAAGAACGCCTCAGGCGGGGTGATGACCTCAGATTGCAGATGGCTCTGGAAGAAAGCCGGAGAGACACAGTAAAAGTTCCAAAAAAGAAAGAGGCGAAAGCTTGTTGCAAGCCAGGCTCCCACTCCCAGCAGACTACCTTGTTGGATTTAATGGATGCCCTCCCCAGCTCAGGCCCTGTTACACAGAAAACTGAGCCCTGGAGTGCAGGAGCCTCTGCTAACCAGACCAACCCCTGGGGTGGAACAGTGGCTCCTTCGAACATTACTGACCCGTGGCCATCGTTTGGTACCAAGCCAGCTGCCTCTGTGGACCCCTGGGGAGTACCTACCACAGCCAGCACACAGTCTGTCCCTAAGAACTCAGACCCTTGGGCAGCCTCACAGCAGCCTGCCTCCAATGCTGGAAAGACAACAGATGCCTGGGGAGCTGCTAAGCCCAGTTCTGCCTCAGGGTCCTTTGAGCTCTTCAGTAATTTCAACGGTACAGTTAAAGATGATTTTTCTGAATTTGACAACCTTCGAACTTCAAAAAAACCAGCTGAGTCAGGGGCCTCAGTGCCACCCCAGGACAGCAGAACCACGAGCCCTGACCTCTTTGAGTCTCAATCCTTGACTTCTGCGTCAAGCAAGCCTAGCAGTGCCAGGAAAACACCTGAGTCCTTCCTGGGCCCCAATGCAGCCCTGGTGAACCTGGACTCATTGGTGACTAAGCCTGCTCCACCAGCTCAGTCCCTTAATCCCTTCCTGGCACCAGGTGCTGCTGCTCCAGCCCCTGTCAACCCCTTCCAGGTCAACCAGCCCCAGCCGCTGACACTGAACCAGCTCCGGGGAAGCCCTGTCCTGGGAAGCAGTGCATCCTTTGGGTCTGGTCCAGGGGTGGAGACTGTGGCTCCCATGACCTCAGTAGCTCCACACTCATCAGTGGGGGCCAGTGGCTCCTCCTTGACACCACTGGGCCCTACAGCAATGAACATGGTAGGCAGTGTGGGCATTCCCCCATCAGCAGCTCAGTCAACAGGCACAACAAACCCTTTCCTTCTCTAG"

mdl_params = {'specie': 'mouse', 'cell_type': 'mES cells', 'datatype': 'slam-seq'}
res_mouse = protein_optimization(seq, mdl_path, mdl_params, crossover_args={}, niterations=n_iterations)
res_mouse['gene'] = 'unstable mouse gene ' + gene_name   


results = pd.concat([res_fish, res_mouse, res_rpe])
results.to_csv('results_data/search.csv', index=False)

